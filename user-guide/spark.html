

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../_static/favicon.ico">
    
    
      
        <title>Spark - Kubeflow Enterprise Docs</title>
      
    
    
      
        
        
      
      

    
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="../_static/sphinx_immaterial_theme.fa3fbbd75cfdd7cef.min.css" />
        <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Kubeflow Enterprise Docs" class="md-header__button md-logo" aria-label="Kubeflow Enterprise Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kubeflow Enterprise Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Spark
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="yellow"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/elements-of-ai/kubeflow-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Kubeflow Docs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Kubeflow Enterprise Docs" class="md-nav__button md-logo" aria-label="Kubeflow Enterprise Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    Kubeflow Enterprise Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/elements-of-ai/kubeflow-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Kubeflow Docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/index.html" class="md-nav__link">
        <span class="md-ellipsis">Overview</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/oss.html" class="md-nav__link">
        <span class="md-ellipsis">Open Source Kubeflow Components</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/ekf.html" class="md-nav__link">
        <span class="md-ellipsis">Kubeflow Enterprise Components and Features</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/mlops.html" class="md-nav__link">
        <span class="md-ellipsis">MLOps with Kubeflow</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
        <label class="md-nav__link" for="__nav_5">
          <span class="md-ellipsis">Install</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Install" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Install</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/index.html" class="md-nav__link">
        <span class="md-ellipsis">Overview</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/ubuntu.html" class="md-nav__link">
        <span class="md-ellipsis">Install Kubeflow on Nimbus</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
        <label class="md-nav__link" for="__nav_6">
          <span class="md-ellipsis">Integration</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Integration" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Integration</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/index.html" class="md-nav__link">
        <span class="md-ellipsis">Overview</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/gitlab.html" class="md-nav__link">
        <span class="md-ellipsis">Git<wbr>Lab</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/identity.html" class="md-nav__link">
        <span class="md-ellipsis">Identity Providers <wbr>(OIDC)</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../integration/auth.html" class="md-nav__link">
        <span class="md-ellipsis">Auth<wbr>Service</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" checked>
      
      
      
        <label class="md-nav__link" for="__nav_7">
          <span class="md-ellipsis">User Guide</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">User Guide</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        <span class="md-ellipsis">Overview</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="notebooks.html" class="md-nav__link">
        <span class="md-ellipsis">Kubeflow Notebooks</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="feast.html" class="md-nav__link">
        <span class="md-ellipsis">Feast</span>
      </a>
    </li>
  

            
          
            
              
  
  
    
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          <span class="md-ellipsis">Spark</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="#" class="md-nav__link md-nav__link--active">
        <span class="md-ellipsis">Spark</span>
      </a>
      
        

  

<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      <span class="md-ellipsis">Spark</span>
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">Overview</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">Prerequisites</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-spark-operator" class="md-nav__link">
    <span class="md-ellipsis">Install Spark operator</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-spark-service-account-and-add-permissions" class="md-nav__link">
    <span class="md-ellipsis">Create Spark Service Account and add permissions</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-the-pipeline-with-a-spark-job" class="md-nav__link">
    <span class="md-ellipsis">Create the pipeline with a Spark job</span>
  </a>
  
    <nav class="md-nav" aria-label="Create the pipeline with a Spark job">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workflow-overview" class="md-nav__link">
    <span title="workflow overview (reference label)" class="md-ellipsis">Workflow Overview</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-packages-and-define-global-variables" class="md-nav__link">
    <span class="md-ellipsis">Import packages and define global variables</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-spark-job-application" class="md-nav__link">
    <span class="md-ellipsis">Define Spark job application</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apply-the-spark-job-manifest-file-and-create-the-job" class="md-nav__link">
    <span class="md-ellipsis">Apply the Spark job manifest file and create the job</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitor-the-spark-job-status" class="md-nav__link">
    <span class="md-ellipsis">Monitor the Spark job status</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-print-messages-function" class="md-nav__link">
    <span class="md-ellipsis">Define print messages function</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-the-pipeline" class="md-nav__link">
    <span class="md-ellipsis">Define the pipeline</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compile-the-pipeline" class="md-nav__link">
    <span class="md-ellipsis">Compile the pipeline</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-execute-and-inspect-the-pipeline" class="md-nav__link">
    <span class="md-ellipsis">Create, execute, and inspect the pipeline</span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="mlmd.html" class="md-nav__link">
        <span class="md-ellipsis">ML Metadata <wbr>(MLMD)</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="mlflow.html" class="md-nav__link">
        <span class="md-ellipsis">MLFlow</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="training.html" class="md-nav__link">
        <span class="md-ellipsis">ML Training</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="tensorboard.html" class="md-nav__link">
        <span class="md-ellipsis">Tensor<wbr>Board</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="katib.html" class="md-nav__link">
        <span class="md-ellipsis">Hyperparameter Tuning</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="kserve.html" class="md-nav__link">
        <span class="md-ellipsis">KServe</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="kfp.html" class="md-nav__link">
        <span class="md-ellipsis">Kubeflow Pipelines</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" checked>
      
      
      
        <label class="md-nav__link" for="__nav_8">
          <span class="md-ellipsis">Use Cases</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Use Cases" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Use Cases</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../use-cases/helmet.html" class="md-nav__link">
        <span class="md-ellipsis">Helmet Detection</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" checked>
      
      
      
        <label class="md-nav__link" for="__nav_9">
          <span class="md-ellipsis">Operation Guide</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Operation Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Operation Guide</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../operation-guide/index.html" class="md-nav__link">
        <span class="md-ellipsis">Overview</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" checked>
      
      
      
        <label class="md-nav__link" for="__nav_10">
          <span class="md-ellipsis">Internals</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Internals" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Internals</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../internals/auth.html" class="md-nav__link">
        <span class="md-ellipsis">Authentication and Authorization</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      <span class="md-ellipsis">Spark</span>
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">Overview</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">Prerequisites</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-spark-operator" class="md-nav__link">
    <span class="md-ellipsis">Install Spark operator</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-spark-service-account-and-add-permissions" class="md-nav__link">
    <span class="md-ellipsis">Create Spark Service Account and add permissions</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-the-pipeline-with-a-spark-job" class="md-nav__link">
    <span class="md-ellipsis">Create the pipeline with a Spark job</span>
  </a>
  
    <nav class="md-nav" aria-label="Create the pipeline with a Spark job">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workflow-overview" class="md-nav__link">
    <span title="workflow overview (reference label)" class="md-ellipsis">Workflow Overview</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-packages-and-define-global-variables" class="md-nav__link">
    <span class="md-ellipsis">Import packages and define global variables</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-spark-job-application" class="md-nav__link">
    <span class="md-ellipsis">Define Spark job application</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apply-the-spark-job-manifest-file-and-create-the-job" class="md-nav__link">
    <span class="md-ellipsis">Apply the Spark job manifest file and create the job</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitor-the-spark-job-status" class="md-nav__link">
    <span class="md-ellipsis">Monitor the Spark job status</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-print-messages-function" class="md-nav__link">
    <span class="md-ellipsis">Define print messages function</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-the-pipeline" class="md-nav__link">
    <span class="md-ellipsis">Define the pipeline</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compile-the-pipeline" class="md-nav__link">
    <span class="md-ellipsis">Compile the pipeline</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-execute-and-inspect-the-pipeline" class="md-nav__link">
    <span class="md-ellipsis">Create, execute, and inspect the pipeline</span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset" role="main">
                  


  <a href="https://github.com/elements-of-ai/kubeflow-docs/blob/master/docs/user-guide/spark.rst" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>

<h1 id="spark">Spark<a class="headerlink" href="#spark" title="Permalink to this heading">¶</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>A typical Machine Learning (ML) workflow consists of three stages: preprocessing, training, and serving. During preprocessing,
data cleaning and data transformations are performed. During the training stage, one or more models are trained. These models
are in turn made available to the target audience in the serving stage. The data generated during serving can be fed back to
the pipeline to help improve model accuracy, keep the model relevant and up-to-date as old training data might become
irrelevant. The increasing amount of data available as input for ML workflows increases the need for efficient processing of
data. And therefore it would be useful for us learn how to integrate Apache Spark into Kubeflow ML workflow.</p>
<p>Using bigger machines to process large amount of data is expensive and sometimes not possible anymore. Hence, the available
solution today is distributed computing. <a class="reference external" href="https://spark.apache.org/">Apache Spark</a> is a distributed computation framework.
It is used widely for data-intensive processing tasks. It is a multi-language engine for executing data engineering, data
science, and machine learning on single-node machines or clusters. It supports multiple powerful features such as streaming
data, SQL analytics, data science at scale and machine learning.</p>
<p>In this guide, we will walk you through an example to show how to integrate Spark into Kubeflow ML workflow.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading">¶</a></h2>
<p>Make sure following prerequisites are fulfilled before starting this experiment:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../install/ubuntu.html#install-ubuntu"><span class="std std-ref">Install Kubeflow on Nimbus</span></a></p></li>
<li><p>Familiar with <a class="reference internal" href="kfp.html#kubeflow-pipelines"><span class="std std-ref">Kubeflow Pipelines</span></a></p></li>
<li><p>Install <code class="docutils literal notranslate"><span class="pre">helm</span></code> CLI following <a class="reference external" href="https://helm.sh/docs/intro/install/">official documentations</a></p></li>
</ul>
<h2 id="install-spark-operator">Install Spark operator<a class="headerlink" href="#install-spark-operator" title="Permalink to this heading">¶</a></h2>
<p>We start from installing Spark operator on Kubernetes cluster. In your terminal, run following commands:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><code>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>spark-operator<span class="w"> </span>https://googlecloudplatform.github.io/spark-on-k8s-operator
<span class="o">[</span>microk8s<span class="o">]</span><span class="w"> </span>kubectl<span class="w"> </span>config<span class="w"> </span>view<span class="w"> </span>--raw<span class="w"> </span>&gt;<span class="w"> </span>~/.kube/config
helm<span class="w"> </span>install<span class="w"> </span>my-release<span class="w"> </span>spark-operator/spark-operator<span class="w"> </span>--namespace<span class="w"> </span>kubeflow
</code></pre></div>
</div>
<p>To confirm your Spark operator is on, run <code class="docutils literal notranslate"><span class="pre">[microk8s]</span> <span class="pre">kubectl</span> <span class="pre">get</span> <span class="pre">pods</span> <span class="pre">-n</span> <span class="pre">kubeflow</span></code>, and you should see pods with name such
as <code class="docutils literal notranslate"><span class="pre">spark-operator-0</span></code> in “Running” status.</p>
<h2 id="create-spark-service-account-and-add-permissions">Create Spark Service Account and add permissions<a class="headerlink" href="#create-spark-service-account-and-add-permissions" title="Permalink to this heading">¶</a></h2>
<p>In this example, we will create a service account called <code class="docutils literal notranslate"><span class="pre">spark-sa</span></code> to run the ML pipeline with Spark job.</p>
<p>First create the YAML file for the service account.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-sa</span>
<span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Role</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-role</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
<span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;pods&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;services&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;configmaps&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;pods/log&quot;</span><span class="p p-Indicator">]</span>
<span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;create&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;post&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;delete&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;patch&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sparkoperator.k8s.io&quot;</span><span class="p p-Indicator">]</span>
<span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sparkapplications&quot;</span><span class="p p-Indicator">]</span>
<span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;create&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;post&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;delete&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;patch&quot;</span><span class="p p-Indicator">]</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-role-binding</span>
<span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-sa</span>
<span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<span class="nt">roleRef</span><span class="p">:</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Role</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-role</span>
<span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
</code></pre></div>
</div>
<div class="note admonition">
<p class="admonition-title">Note</p>
<p>In this example, we create the service account under <code class="docutils literal notranslate"><span class="pre">admin</span></code> namespace. You may change that based on your own situation
and need.</p>
</div>
<p>We then apply the YAML file to create the <code class="docutils literal notranslate"><span class="pre">spark-sa</span></code> service account using following command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><code><span class="o">[</span>microk8s<span class="o">]</span><span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>&lt;create_service_account_yaml_file&gt;
</code></pre></div>
</div>
<h2 id="create-the-pipeline-with-a-spark-job">Create the pipeline with a Spark job<a class="headerlink" href="#create-the-pipeline-with-a-spark-job" title="Permalink to this heading">¶</a></h2>
<p>Now, it’s time to get started with concreate coding work to create a pipeline with a Spark job.</p>
<p>Go to the Kubeflow UI in your browser. (If you follow the guide <a class="reference internal" href="../install/ubuntu.html#install-ubuntu"><span class="std std-ref">Install Kubeflow on Nimbus</span></a>, you can access Kubeflow UI by going to
<code class="docutils literal notranslate"><span class="pre">http://10.64.140.43.nip.io</span></code>.) Connect or start a Notebook Server, and create a <code class="docutils literal notranslate"><span class="pre">.ipynb</span></code> file.</p>
<h3 id="workflow-overview"><span id="id1"></span>Workflow Overview<a class="headerlink" href="#workflow-overview" title="Permalink to this heading">¶</a></h3>
<p>The main challage here is to orchestrate a Spark job from Kubeflow and submit it to the cluster. We will solve this by using
pipeline components for kubernetes.</p>
<p>We will create a <em>k8s apply component</em> to load the Spark job manifest file and perform <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">apply</span></code> to submit it to the
cluster. In this way, a <code class="docutils literal notranslate"><span class="pre">sparkapplication</span></code> resource would be created in the cluster.</p>
<p>We will also need to create a <em>k8s get component</em> to periodically poll the <em>control plane</em> to get the status of the Spark job.
And once the job is in “COMPLETED” state, the pipeline will move to the next step.</p>
<p>The overall workflow of Spark job in Kubeflow pipeline is shown in below figure.</p>
<blockquote>
<div><img alt="../_images/user-guide-spark-overview.jpg" src="../_images/user-guide-spark-overview.jpg" />
</div></blockquote>
<h3 id="import-packages-and-define-global-variables">Import packages and define global variables<a class="headerlink" href="#import-packages-and-define-global-variables" title="Permalink to this heading">¶</a></h3>
<p>Import packages and define global variables needed for this example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">yaml</span>

<span class="kn">import</span> <span class="nn">kfp.components</span> <span class="k">as</span> <span class="nn">comp</span>
<span class="kn">import</span> <span class="nn">kfp.dsl</span> <span class="k">as</span> <span class="nn">dsl</span>

<span class="n">SPARK_COMPLETED_STATE</span> <span class="o">=</span> <span class="s2">&quot;COMPLETED&quot;</span>
<span class="n">SPARK_APPLICATION_KIND</span> <span class="o">=</span> <span class="s2">&quot;sparkapplications&quot;</span>
</code></pre></div>
</div>
<h3 id="define-spark-job-application">Define Spark job application<a class="headerlink" href="#define-spark-job-application" title="Permalink to this heading">¶</a></h3>
<p>In this example, we will create a simple Spark job that calculates an approximate value of Pi(π). Below is the YAML file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sparkoperator.k8s.io/v1beta2&quot;</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SparkApplication</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pyspark-pi-{epoch}</span>
<span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Python</span>
<span class="w">  </span><span class="nt">pythonVersion</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
<span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;gcr.io/spark-operator/spark-py:v3.1.1&quot;</span>
<span class="w">  </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<span class="w">  </span><span class="nt">mainApplicationFile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local:///opt/spark/examples/src/main/python/pi.py</span>
<span class="w">  </span><span class="nt">sparkVersion</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.1.1&quot;</span>
<span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OnFailure</span>
<span class="w">    </span><span class="nt">onFailureRetries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">    </span><span class="nt">onFailureRetryInterval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">    </span><span class="nt">onSubmissionFailureRetries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">    </span><span class="nt">onSubmissionFailureRetryInterval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="w">  </span><span class="nt">driver</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cores</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">coreLimit</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1200m&quot;</span>
<span class="w">    </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;512m&quot;</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.1.1</span>
<span class="w">    </span><span class="nt">serviceAccount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark-sa</span>
<span class="w">  </span><span class="nt">executor</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cores</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">instances</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;512m&quot;</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.1.1</span>
</code></pre></div>
</div>
<p>We then define following function to get the Spark job definition. It reads the Spark Operator job manifest file and returns
the corresponding dictionary and add some randomness in the job name.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_spark_job_definition</span><span class="p">():</span>
    <span class="c1"># Read manifest file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;&lt;spark_job_definition_yaml_file&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
        <span class="n">spark_job_manifest</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>

    <span class="c1"># Add epoch time in the job name</span>
    <span class="n">epoch</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
    <span class="n">spark_job_manifest</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spark_job_manifest</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">spark_job_manifest</span>
</code></pre></div>
</div>
<h3 id="apply-the-spark-job-manifest-file-and-create-the-job">Apply the Spark job manifest file and create the job<a class="headerlink" href="#apply-the-spark-job-manifest-file-and-create-the-job" title="Permalink to this heading">¶</a></h3>
<p>As explained in <a class="reference internal" href="#workflow-overview"><span class="std std-ref">Workflow Overview</span></a>, our next step is to use <em>k8s apply component</em> to load the Spark job manifest file
and create the corresponding <code class="docutils literal notranslate"><span class="pre">sparkapplication</span></code> resource in the cluster.</p>
<p>Define the <em>k8s apply component</em> using following YAML file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Apply Kubernetes object</span>
<span class="nt">inputs</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="nv">Object</span><span class="p p-Indicator">,</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">JsonObject</span><span class="p p-Indicator">}</span>
<span class="nt">outputs</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="nv">Name</span><span class="p p-Indicator">,</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">String</span><span class="p p-Indicator">}</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="nv">Kind</span><span class="p p-Indicator">,</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">String</span><span class="p p-Indicator">}</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="nv">Object</span><span class="p p-Indicator">,</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">JsonObject</span><span class="p p-Indicator">}</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">author</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Alexey Volkov &lt;alexey.volkov@ark-kun.com&gt;</span>
<span class="nt">implementation</span><span class="p">:</span>
<span class="nt">container</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bitnami/kubectl:1.17.17</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bash</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-exc</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">object_path=$0</span>
<span class="w">        </span><span class="no">output_name_path=$1</span>
<span class="w">        </span><span class="no">output_kind_path=$2</span>
<span class="w">        </span><span class="no">output_object_path=$3</span>
<span class="w">        </span><span class="no">mkdir -p &quot;$(dirname &quot;$output_name_path&quot;)&quot;</span>
<span class="w">        </span><span class="no">mkdir -p &quot;$(dirname &quot;$output_kind_path&quot;)&quot;</span>
<span class="w">        </span><span class="no">mkdir -p &quot;$(dirname &quot;$output_object_path&quot;)&quot;</span>
<span class="w">        </span><span class="no">kubectl apply -f &quot;$object_path&quot; --output=json &gt; &quot;$output_object_path&quot;</span>
<span class="w">        </span><span class="no">&lt; &quot;$output_object_path&quot; jq &#39;.metadata.name&#39; --raw-output &gt; &quot;$output_name_path&quot;</span>
<span class="w">        </span><span class="no">&lt; &quot;$output_object_path&quot; jq &#39;.kind&#39; --raw-output &gt; &quot;$output_kind_path&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">inputPath</span><span class="p">:</span><span class="w"> </span><span class="nv">Object</span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">outputPath</span><span class="p">:</span><span class="w"> </span><span class="nv">Name</span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">outputPath</span><span class="p">:</span><span class="w"> </span><span class="nv">Kind</span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">outputPath</span><span class="p">:</span><span class="w"> </span><span class="nv">Object</span><span class="p p-Indicator">}</span>
</code></pre></div>
</div>
<p>We will use this file in later <a class="reference internal" href="#define-pipeline"><span class="std std-ref">Define the pipeline</span></a> step.</p>
<h3 id="monitor-the-spark-job-status">Monitor the Spark job status<a class="headerlink" href="#monitor-the-spark-job-status" title="Permalink to this heading">¶</a></h3>
<p>As mentioned in <a class="reference internal" href="#workflow-overview"><span class="std std-ref">Workflow Overview</span></a>, after the <code class="docutils literal notranslate"><span class="pre">apply</span></code> operation, the execution engine has to wait for the job to complete
before moving on to the next pipeline step. We will define a <em>k8s get component</em> to periodically get the application’s state
and it will iterate until the job achieves “COMPLETED” state.</p>
<p>The iteration would be done using recursion and the <code class="docutils literal notranslate"><span class="pre">dsl.Condition</span></code> instruction, and we will use <code class="docutils literal notranslate"><span class="pre">&#64;graph_component</span></code> decorator
to indicate the recursive execution for the function.</p>
<p>The <em>k8s get component</em> is defined using following YAML file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Get Kubernetes object</span>
<span class="nt">inputs</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="nv">Name</span><span class="p p-Indicator">,</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">String</span><span class="p p-Indicator">}</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="nv">Kind</span><span class="p p-Indicator">,</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">String</span><span class="p p-Indicator">}</span>
<span class="nt">outputs</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="nv">Name</span><span class="p p-Indicator">,</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">String</span><span class="p p-Indicator">}</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="nv">ApplicationState</span><span class="p p-Indicator">,</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">String</span><span class="p p-Indicator">}</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="nv">Object</span><span class="p p-Indicator">,</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">JsonObject</span><span class="p p-Indicator">}</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">author</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Alexey Volkov &lt;alexey.volkov@ark-kun.com&gt;</span>
<span class="nt">implementation</span><span class="p">:</span>
<span class="nt">container</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bitnami/kubectl:1.17.17</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bash</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-exc</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">object_name=$0</span>
<span class="w">        </span><span class="no">object_type=$1</span>
<span class="w">        </span><span class="no">output_name_path=$2</span>
<span class="w">        </span><span class="no">output_state_path=$3</span>
<span class="w">        </span><span class="no">output_object_path=$4</span>
<span class="w">        </span><span class="no">mkdir -p &quot;$(dirname &quot;$output_name_path&quot;)&quot;</span>
<span class="w">        </span><span class="no">mkdir -p &quot;$(dirname &quot;$output_state_path&quot;)&quot;</span>
<span class="w">        </span><span class="no">mkdir -p &quot;$(dirname &quot;$output_object_path&quot;)&quot;</span>
<span class="w">        </span><span class="no">kubectl get &quot;$object_type&quot; &quot;$object_name&quot; --output=json &gt; &quot;$output_object_path&quot;</span>
<span class="w">        </span><span class="no">&lt; &quot;$output_object_path&quot; jq &#39;.metadata.name&#39; --raw-output &gt; &quot;$output_name_path&quot;</span>
<span class="w">        </span><span class="no">&lt; &quot;$output_object_path&quot; jq &#39;.status.applicationState.state&#39; --raw-output &gt; &quot;$output_state_path&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">inputValue</span><span class="p">:</span><span class="w"> </span><span class="nv">Name</span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">inputValue</span><span class="p">:</span><span class="w"> </span><span class="nv">Kind</span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">outputPath</span><span class="p">:</span><span class="w"> </span><span class="nv">Name</span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">outputPath</span><span class="p">:</span><span class="w"> </span><span class="nv">ApplicationState</span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">outputPath</span><span class="p">:</span><span class="w"> </span><span class="nv">Object</span><span class="p p-Indicator">}</span>
</code></pre></div>
</div>
<p>Above executions are defined in following function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span class="nd">@dsl</span><span class="o">.</span><span class="n">graph_component</span>
<span class="k">def</span> <span class="nf">graph_component_spark_app_status</span><span class="p">(</span><span class="n">input_application_name</span><span class="p">):</span>
    <span class="n">k8s_get_op</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">load_component_from_file</span><span class="p">(</span><span class="s2">&quot;&lt;k8s_get_component_definition_yaml_file&gt;&quot;</span><span class="p">)</span>
    <span class="n">check_spark_application_status_op</span> <span class="o">=</span> <span class="n">k8s_get_op</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">input_application_name</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="n">SPARK_APPLICATION_KIND</span>
    <span class="p">)</span>
    <span class="c1"># Remove cache</span>
    <span class="n">check_spark_application_status_op</span><span class="o">.</span><span class="n">execution_options</span><span class="o">.</span><span class="n">caching_strategy</span><span class="o">.</span><span class="n">max_cache_staleness</span> <span class="o">=</span> <span class="s2">&quot;P0D&quot;</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">dsl</span><span class="o">.</span><span class="n">Condition</span><span class="p">(</span><span class="n">check_spark_application_status_op</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;applicationstate&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">SPARK_COMPLETED_STATE</span><span class="p">):</span>
        <span class="n">graph_component_spark_app_status</span><span class="p">(</span><span class="n">check_spark_application_status_op</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
</code></pre></div>
</div>
<p>Once the Spark application is completed, the execution will carry on with other pipeline steps.</p>
<h3 id="define-print-messages-function">Define print messages function<a class="headerlink" href="#define-print-messages-function" title="Permalink to this heading">¶</a></h3>
<p>Before defining our final pipeline, we spend some time defining following function to print messages.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">print_op</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">dsl</span><span class="o">.</span><span class="n">ContainerOp</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Print message.&quot;</span><span class="p">,</span>
        <span class="n">image</span><span class="o">=</span><span class="s2">&quot;alpine:3.6&quot;</span><span class="p">,</span>
        <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;echo&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">],</span>
    <span class="p">)</span>
</code></pre></div>
</div>
<h3 id="define-the-pipeline"><span id="define-pipeline"></span>Define the pipeline<a class="headerlink" href="#define-the-pipeline" title="Permalink to this heading">¶</a></h3>
<p>We can now define our final pipeline using above functions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span class="nd">@dsl</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Spark Operator job pipeline&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Spark Operator job pipeline&quot;</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">spark_job_pipeline</span><span class="p">():</span>

    <span class="c1"># Load spark job manifest</span>
    <span class="n">spark_job_definition</span> <span class="o">=</span> <span class="n">get_spark_job_definition</span><span class="p">()</span>

    <span class="c1"># Load the kubernetes apply component</span>
    <span class="n">k8s_apply_op</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">load_component_from_file</span><span class="p">(</span><span class="s2">&quot;&lt;k8s_apply_component_definition_yaml_file&gt;&quot;</span><span class="p">)</span>

    <span class="c1"># Execute the apply command</span>
    <span class="n">spark_job_op</span> <span class="o">=</span> <span class="n">k8s_apply_op</span><span class="p">(</span><span class="nb">object</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">spark_job_definition</span><span class="p">))</span>

    <span class="c1"># Fetch spark job name</span>
    <span class="n">spark_job_name</span> <span class="o">=</span> <span class="n">spark_job_op</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

    <span class="c1"># Remove cache for the apply operator</span>
    <span class="n">spark_job_op</span><span class="o">.</span><span class="n">execution_options</span><span class="o">.</span><span class="n">caching_strategy</span><span class="o">.</span><span class="n">max_cache_staleness</span> <span class="o">=</span> <span class="s2">&quot;P0D&quot;</span>

    <span class="n">spark_application_status_op</span> <span class="o">=</span> <span class="n">graph_component_spark_app_status</span><span class="p">(</span><span class="n">spark_job_op</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
    <span class="n">spark_application_status_op</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="n">spark_job_op</span><span class="p">)</span>

    <span class="n">print_message</span> <span class="o">=</span> <span class="n">print_op</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">spark_job_name</span><span class="si">}</span><span class="s2"> is completed.&quot;</span><span class="p">)</span>
    <span class="n">print_message</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="n">spark_application_status_op</span><span class="p">)</span>
    <span class="n">print_message</span><span class="o">.</span><span class="n">execution_options</span><span class="o">.</span><span class="n">caching_strategy</span><span class="o">.</span><span class="n">max_cache_staleness</span> <span class="o">=</span> <span class="s2">&quot;P0D&quot;</span>
</code></pre></div>
</div>
<h3 id="compile-the-pipeline"><span id="compile-pipeline"></span>Compile the pipeline<a class="headerlink" href="#compile-the-pipeline" title="Permalink to this heading">¶</a></h3>
<p>Finally, we compile the pipeline using following codes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">pipeline_func</span> <span class="o">=</span> <span class="n">spark_job_pipeline</span>
    <span class="n">pipeline_filename</span> <span class="o">=</span> <span class="n">pipeline_func</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;.yaml&quot;</span>
    <span class="n">compiler</span><span class="o">.</span><span class="n">Compiler</span><span class="p">()</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pipeline_func</span><span class="p">,</span> <span class="n">pipeline_filename</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated pipeline file: </span><span class="si">{</span><span class="n">pipeline_filename</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<h2 id="create-execute-and-inspect-the-pipeline">Create, execute, and inspect the pipeline<a class="headerlink" href="#create-execute-and-inspect-the-pipeline" title="Permalink to this heading">¶</a></h2>
<div class="note admonition">
<p class="admonition-title">Note</p>
<p>Details and screenshots of how to create pipelines from YAML file and how to create experiments and runs are included in
<a class="reference internal" href="kfp.html#kubeflow-pipelines"><span class="std std-ref">Kubeflow Pipelines</span></a>.</p>
</div>
<p>After <a class="reference internal" href="#compile-pipeline"><span class="std std-ref">Compile the pipeline</span></a>, you should see the YAML file of your pipeline generated in the corresponding directory.</p>
<blockquote>
<div><img alt="../_images/user-guide-spark-seePipelineYAML.png" src="../_images/user-guide-spark-seePipelineYAML.png" />
</div></blockquote>
<p>Download the YAML file. And create the pipeline using this YAML file.</p>
<p>The pipeline should be like following:</p>
<blockquote>
<div><img alt="../_images/user-guide-spark-pipeline.png" src="../_images/user-guide-spark-pipeline.png" />
</div></blockquote>
<p>Create an experiment for this pipeline, and then create a run. Remember to set the Service Account as <code class="docutils literal notranslate"><span class="pre">spark-sa</span></code>.</p>
<blockquote>
<div><img alt="../_images/user-guide-spark-serviceAccount.png" src="../_images/user-guide-spark-serviceAccount.png" />
</div></blockquote>
<p>Start the pipeline run, and wait for the pipeline to finish. A successful pipeline run should look like below:</p>
<blockquote>
<div><img alt="../_images/user-guide-spark-success.png" src="../_images/user-guide-spark-success.png" />
</div></blockquote>
<p>Feel free to click on each pipeline step to see the component running details.</p>
<div class="seealso admonition">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://sbakiu.medium.com/orchestrating-spark-jobs-with-kubeflow-for-ml-workflows-830f802a99fe">Orchestrating Spark Jobs with Kubeflow for ML Workflows</a></p>
</div>






                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="feast.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Feast" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Feast
            </div>
          </div>
        </a>
      
      
        
        <a href="mlmd.html" class="md-footer__link md-footer__link--next" aria-label="Next: ML Metadata (MLMD)" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              ML Metadata (MLMD)
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        &#169; Copyright 2023, Elements of AI.
        
    </div>
  
    Created using
    <a href="https://www.sphinx-doc.org/" target="_blank" rel="noopener">Sphinx</a>
    6.1.3.
     and
    <a href="https://github.com/jbms/sphinx-immaterial/" target="_blank" rel="noopener">Sphinx-Immaterial</a>
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand", "navigation.sections", "navigation.top", "search.share"], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
      
        <script src="../_static/sphinx_immaterial_theme.cea6a0c1d5b0618cf.min.js"></script>
    
  </body>
</html>